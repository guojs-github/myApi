if("undefined"==typeof jQuery)throw new Error("myApi: This plugin requires jQuery");var myApi;$(function(){console.log("myApi loading."),myApi.string.init()}),(myApi=myApi||{}).browser={BROWSER_TYPE:{UNKNOWN:"Unknown",OPERA:"Opera",FIREFOX:"Firefox",CHROME:"Chrome",SAFARI:"Safari",EDGE:"Edge",WEIXIN:"Weixin",IE:"IE"},type:function(){console.log("Browser type");var e=navigator.userAgent,t=-1<e.indexOf("Opera"),o=-1<e.indexOf("compatible")&&-1<e.indexOf("MSIE")&&!t,n=-1<e.indexOf("Trident")&&-1<(-1<e.indexOf("rv"))&&!o,i=-1<e.indexOf("Edge")&&!n,r=-1<e.toLowerCase().indexOf("micromessenger"),s=-1<e.indexOf("Firefox"),l=-1<e.indexOf("Safari")&&-1==e.indexOf("Chrome")&&!r,a=-1<e.indexOf("Chrome")&&-1<e.indexOf("Safari")&&!r,c=null;try{return o?(new RegExp("MSIE (\\d+\\.\\d+);").test(e),7<=(c=parseFloat(RegExp.$1))&&c<=11?this.BROWSER_TYPE.IE+c:this.BROWSER_TYPE.IE):n?this.BROWSER_TYPE.IE+"11":i?this.BROWSER_TYPE.EDGE:t?this.BROWSER_TYPE.OPERA:s?this.BROWSER_TYPE.FIREFOX:l?this.BROWSER_TYPE.SAFARI:a?this.BROWSER_TYPE.CHROME:r?this.BROWSER_TYPE.WEIXIN:this.BROWSER_TYPE.UNKNOWN}catch(e){throw e}finally{c=a=l=s=i=o=t=e=null}},isIE:function(){console.log("Is ie browser?");var e=this.type();try{return-1<e.indexOf(this.BROWSER_TYPE.IE)}catch(e){throw e}finally{e=null}},availHeight:function(){var e=40,t=0;try{return this.type(),this.isIE()?(t=108,screen.availHeight-t):(this.BROWSER_TYPE.CHROME,t=90,screen.availHeight-e-t)}catch(e){throw e}finally{t=e=null}},language:function(){console.log("Get browser language");var e=this.type(),t="en";try{return-1<e.indexOf(this.BROWSER_TYPE.IE)?window.navigator.userLanguage.toLowerCase():window.navigator.language.toLowerCase()}catch(e){return t}finally{t=e=null}},isChinese:function(){return console.log("The language is chinese?"),"zh-cn"==this.language()}},(myApi=myApi||{}).common={queryString:function(e){console.log("Get query string."),console.log("key:"+e);var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),o=window.location.search.substr(1).match(t),n="";return null!=o&&(n=o[2]),(o=t=null)==n||""==n||"undefined"==n?"":n},checkMobile:function(e){return console.log("Check mobile phone number."),console.log("value:"+e),/^[1][3,4,5,6,7,8,9][0-9]{9}$/.test(e)},stopBubble:function(e){console.log("Stop bubble"),e&&e.stopPropagation?e.stopPropagation():window.event.cancelBubble=!0},ref:function(e,t){if(console.log("Add file reference to page"),"string"!=typeof e||e.trim().length<=0)console.log("Invalid reference type.");else if(console.log("type:"+e),"string"!=typeof t||t.trim().length<=0)console.log("Invalid reference file name.");else{console.log("file:"+t);var o=myApi.time.formatTime(new Date);if("css"==e){var n=document.createElement("link");n.setAttribute("type","text/css"),n.setAttribute("rel","stylesheet"),n.setAttribute("href",t+"?t="+o),$("head")[0].appendChild(n)}else if("js"==e){var i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src",t+"?t="+o),$("body")[0].appendChild(i)}}}},(myApi=myApi||{}).cookie=new function(){var o="/",n=function(){var e={},t=document.cookie;if(console.log("cookie:"+t),""===t)return e;for(var o=t.split("; "),n=0;n<o.length;n++){var i=o[n],r=i.indexOf("="),s=i.substring(0,r),l=i.substring(r+1);l=decodeURIComponent(l),e[s]=l}return e}();var i=[];for(var e in n)i.push(e);this.length=i.length,this.key=function(e){return console.log("Get specified cookie;"),console.log("n:"+e),e<0||e>=i.length?null:i[e]},this.setItem=function(e,t){console.log("Set cookie."),console.log("key:"+e),console.log("value:"+t),e in n||(i.push(e),this.length++),n[e]=t;var o=e+"="+encodeURIComponent(t);o+="; max-age="+864e5,o+="; path=/",document.cookie=o},this.getItem=function(e){return console.log("Get cookie."),console.log("key:"+e),void 0===n[e]||null==n[e]?"":n[e]},this.removeItem=function(e){if(console.log("Remove cookie."),console.log("key:"+e),e in n){delete n[e];for(var t=0;t<i.length;t++)if(i[t]===e){i.splice(t,1);break}this.length--,document.cookie=e+"=; max-age=0; path="+o}},this.clear=function(){console.log("Clear cookie.");for(var e=0;e<i.length;e++)document.cookie=i[e]+"=; max-age=0; path="+o;n={},i=[],this.length=0}},(myApi=myApi||{}).number={formatAmount:function(e,t){var o=e;if(e<0&&(e=0-e),/[^0-9\.]/.test(e))return"0.00";if(null==e||"null"==e||""==e)return"0.00";0<t&&(e=new Number(e).toFixed(t)),e=(e=((e=e.toString().replace(/^(\d*)$/,"$1."))+"00").replace(/(\d*\.\d\d)\d*/,"$1")).replace(".",",");for(var n=/(\d)(\d{3},)/;n.test(e);)e=e.replace(n,"$1,$2");if(e=e.replace(/,(\d\d)$/,".$1"),0==t){var i=e.split(".");"00"==i[1]&&(e=i[0])}return o=o<0?"("+e+")":e}},(myApi=myApi||{}).request={requestTimeout:3e3,post:function(e,t,o,n,i){console.log("Send a post request."),console.log("url:"+e),console.log("param:"+JSON.stringify(t));var r=this.requestTimeout;"number"==typeof i&&0<i&&(r=i),myApi.display.loading.show();var s=$.ajax({url:e,type:"POST",data:JSON.stringify(t),cache:!1,timeout:r,dataType:"json",error:function(e,t,o){console.log("Request fail."),console.log("request:"+JSON.stringify(e)),console.log("status:"+JSON.stringify(t)),console.log("err:"+JSON.stringify(o)),"function"==typeof n&&n(e,t,o)},success:function(e){console.log("Request success"),console.log("data:"+JSON.stringify(e)),"function"==typeof o&&o(e)},complete:function(e,t){myApi.display.loading.hide(),"timeout"==t&&s.abort()}})},get:function(e,t,n,o){console.log("Send a get request."),console.log("url:"+e);var i=this.requestTimeout;"number"==typeof o&&0<o&&(i=o),myApi.display.loading.show();var r=$.ajax({url:e,type:"GET",cache:!1,timeout:i,dataType:"json",error:function(e,t,o){console.log("Request fail."),console.log("request:"+JSON.stringify(e)),console.log("status:"+JSON.stringify(t)),console.log("err:"+JSON.stringify(o)),"function"==typeof n&&n(e,t,o)},success:function(e){console.log("Request success"),console.log("data:"+JSON.stringify(e)),"function"==typeof t&&t(e)},complete:function(e,t){myApi.display.loading.hide(),"timeout"==t&&r.abort()}})}},(myApi=myApi||{}).storage=new function(){var o;o=window.localStorage?window.localStorage:require("./cookie.js")(),this.setItem=function(e,t){o.setItem(e,t)},this.getItem=function(e){var t=o.getItem(e);return void 0===t||null==t?"":t},this.removeItem=function(e){o.removeItem(e)},this.clear=function(){o.clear()}},(myApi=myApi||{}).string={init:function(){console.log("Initialize myapi string library."),this.trim()},trim:function(){console.log("Add trim routines."),"function"!=typeof String.trim&&(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")}),"function"!=typeof String.ltrim&&(String.prototype.ltrim=function(){return this.replace(/(^\s*)/g,"")}),"function"!=typeof String.rtrim&&(String.prototype.rtrim=function(){return this.replace(/(\s*$)/g,"")})}},(myApi=myApi||{}).time={formatDuration:function(e){if(console.log("Format duration:"+e),"number"!=typeof e)return"";if(e<0)return"";var t=e,o=(t-t%3600)/3600,n=((t-=3600*o)-t%60)/60,i="";return 0<o&&(i+=o+"时"),(0<n||0<o)&&(i+=n+"分"),i+=(t-=60*n)+"秒"},formatTime:function(e){if(null==e)return"";if(isNaN(e))return"";var t="";return t+=e.getFullYear(),t+="-",t+=$.trim(""+(e.getMonth()+1)).length<2?"0"+(e.getMonth()+1):e.getMonth()+1,t+="-",t+=$.trim(""+e.getDate()).length<2?"0"+e.getDate():e.getDate(),t+=" ",t+=$.trim(""+e.getHours()).length<2?"0"+e.getHours():e.getHours(),t+=":",t+=$.trim(""+e.getMinutes()).length<2?"0"+e.getMinutes():e.getMinutes()},formatDateString:function(e,t){if(console.log("Format date string"),console.log("dateString:"+e),console.log("sep:"+t),"string"!=typeof e||8!=e.trim().length)return"";var o=e.trim(),n="-";"string"==typeof t&&0<t.trim().length&&(n=t.trim());var i="";return i+=o.substring(0,4),i+=n+o.substring(4,6),i+=n+o.substring(6,8)},formatDate:function(e,t){var o=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),r=void 0===t?"-":t;return o+r+(n<10?"0"+n:n)+r+(i<10?"0"+i:i)},addSeconds:function(e,t){if(null==e)return null;if(isNaN(e))return null;if(null==t)return null;if(isNaN(t))return null;var o=e.getTime(),n=new Date;return n.setTime(o+1e3*t),n},addDays:function(e,t){return myApi.time.addSeconds(e,24*t*3600)}},(myApi=myApi||{}).wx={init:function(e,t,o){console.log("Initialize wx api."),console.log("param:"+JSON.stringify(e));var n=!1;wx.config({debug:!1,appId:e.appId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["chooseWXPay","chooseImage","uploadImage","scanQRCode"]}),wx.ready(function(){console.log("JSAPI ready."),0==n&&"function"==typeof t&&t()}),wx.error(function(e){console.log("JSAPI initialize fail."),n=!0,"function"==typeof o&&o()})},scan:function(t,o){console.log("Scan"),wx.checkJsApi({jsApiList:["scanQRCode"],success:function(e){if(console.log("res:"+JSON.stringify(e)),e.errMsg.indexOf("ok")<0)return console.log("Error occurred:"+e.errMsg),void("function"==typeof o&&o("扫描功能检测失败"));1==e.checkResult.scanQRCode?(console.log("Scan qr code allowed."),wx.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(e){if(console.log("scan res:"+JSON.stringify(e)),e.errMsg.indexOf("ok")<0)return console.log("Error occurred while scan:"+e.errMsg),void("function"==typeof o&&o("扫描功能未获授权"));console.log("scan success"),"function"==typeof t&&t(e.resultStr)}})):(console.log("Scan qr code no allowed."),"function"==typeof o&&o("扫描功能未获授权"))}})}},(myApi=myApi||{}).display=myApi.display||{},myApi.display.loading={show:function(){console.log("Show loading."),this.hide();var e=document.createElement("div");e.setAttribute("class","myApi-loading"),document.body.appendChild(e)},hide:function(){console.log("Hide loading.");try{document.body.removeChild(document.querySelector("div.myApi-loading"))}catch(e){}}},(myApi=myApi||{}).display=myApi.display||{},myApi.display.toast={show:function(e){if(console.log("Show toast."),"object"==typeof e)if("string"!=typeof e.message||e.message.trim().length<=0)console.log("Invalid message.");else{console.log("message:"+e.message);try{document.body.removeChild(document.querySelector("div.myApi-toast"))}catch(e){}var t=e.delay||3e3;console.log("delay:"+t);var o=document.createElement("div");o.setAttribute("class","myApi-toast");var n=document.createElement("div");n.setAttribute("class","myApi-toast-mask"),o.appendChild(n);var i=document.createElement("div");i.setAttribute("class","myApi-toast-dialog");var r=document.createElement("div");r.setAttribute("class","myApi-toast-content");var s=document.createTextNode(e.message);r.appendChild(s),i.appendChild(r),o.appendChild(i),document.body.appendChild(o),setTimeout(function(){try{document.body.removeChild(o),"function"==typeof e.complete&&e.complete()}catch(e){}},t)}else console.log("Invalid param.")}};